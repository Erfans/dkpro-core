<%
import Util;

typesystems
    .collect { it.types }
    .flatten()
    .sort { it.name.tokenize('.')[-1] }
    .unique { it.name }
    .each { type -> %>
[[type-${ type.name }]]
=== ${type.name.tokenize('.')[-1]}

*_Name:_* __${type.name}__ +
*_Supertype:_* __${Util.typeLink(type.supertypeName)}__ +

++++
${type.description}
++++

<% if (type.features) {%>
[discrete]
==== Features of ${Util.typeLink(type.name)}
<% type.features.sort { type.name }.each { %>
${it.name} (__${Util.typeLink(it.rangeTypeName)}__<%
if (it.elementType) {
  out.print " of ${Util.typeLink(it.elementType)}"
} %>):: ${it.description ?: '__No description__'}
<% } %>
<% } // if (type.features) %>

<%
def subtypes = typesystems
    .collect { it.types }
    .flatten()
    .sort { it.name.tokenize('.')[-1] }
    .unique { it.name }
    .findAll { it.supertypeName == type.name };
    
if (subtypes) {
%>
[discrete]
==== Sub-types of ${Util.typeLink(type.name)}
[options="header"]
|====
|Type|Description
<% subtypes.each { subtype -> %>
|${Util.typeLink(subtype.name)}
|${Util.shortDesc(subtype.description)}
<% } // subtypes.each { subtype -> %>

|====
<% } // if (subtypes) %>

<% } %>
