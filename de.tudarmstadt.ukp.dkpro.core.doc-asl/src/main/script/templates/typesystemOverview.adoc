<%
import java.text.BreakIterator;

def shortDesc(description) {
    if (description) {
        BreakIterator tokenizer = BreakIterator.getSentenceInstance(Locale.US);
        tokenizer.setText(description);
        def start = tokenizer.first();
        def end = tokenizer.next();
        if (start > -1 && end > -1) {
            description = description.substring(start, end);
        }
        description = description.replaceAll(']', '{endsb}').replaceAll('\n', '<br />').trim();
    }
    return description ? "pass:[${description}]" : '__No description__';
}
%>

.Top-level Types
[options="header"]
|====
|Type|Description

<% typesystems.collect { it.types }.flatten().sort { it.name.tokenize('.')[-1] }.unique { it.name }.findAll {
   it.supertypeName in ['org.apache.uima.jcas.cas.TOP', 'uima.tcas.Annotation'] }.each { %>
| <<type-${ it.name },${ it.name.tokenize('.')[-1] }>>
| ${shortDesc(it.description)}

<% } %>
|====

<% typesystems.collect { it.types }.flatten().sort { it.name.tokenize('.')[-1] }.unique { it.name }.findAll {
   !(it.supertypeName in ['org.apache.uima.jcas.cas.TOP', 'uima.tcas.Annotation']) }.
   groupBy { it.supertypeName }.each { %>
.Sub-types of <<type-${it.key},${it.key.tokenize('.')[-1]}>>
[options="header"]
|====
|Type|Description
<% it.value.each { %>
|<<type-${ it.name },${ it.name.tokenize('.')[-1] }>>
| ${shortDesc(it.description)}

<% } %>

|====
<% } %>
