<% 
import static groovy.json.StringEscapeUtils.escapeJava;

engines
    .sort { it.key }
    .groupBy {it.value.role }
    .sort { it.key != 'Other' ? it.key : 'Z' }
    .each { group -> 
%>
=== ${group.key}

<% group.value.each { %>
[[engine-${ it.key }]]
==== ${it.key}

*_Role_:* __${it.value.role}__ +
*_Artifact ID:_* __${it.value.artifactId}__ +
*_Class:_* __${it.value.spec.annotatorImplementationName}__

++++
${it.value.spec.metaData.description}
++++

<%
def paramDecls = it.value.spec.metaData.configurationParameterDeclarations
    .configurationParameters.sort { it.name }.groupBy { it.name };
def paramValues = it.value.spec.metaData.configurationParameterSettings
    .parameterSettings.sort { it.name }.groupBy { it.name };
    
if (paramDecls) { 
%>
[discrete]
===== Parameters
<% paramDecls.each { %>
${it.key} (__${it.value[0].type}<% 
if (it.value[0].multiValued) { %>[]<% } 
%>__)<%
if (paramValues[it.key]) { %> = `<%
out.print escapeJava(String.valueOf(paramValues[it.key][0].value))
    .replaceAll('`','{backtick}')   
%>` <% } 
if (!it.value[0].mandatory) { %> [optional]<% } 
%>::
+ 
++++
${it.value[0].description}
++++
<% } // paramDecls.each %>
<% } // if (paramDecls) %>

<%
def inputs = it.value.spec.analysisEngineMetaData?.capabilities?.collect { 
        it.inputs?.collect { it.name  } }.flatten().sort().unique();
def outputs = it.value.spec.analysisEngineMetaData?.capabilities?.collect { 
        it.outputs?.collect { it.name  } }.flatten().sort().unique();

if (inputs || outputs) {
%>
[discrete]
===== Inputs and outputs
[cols="h,v"]
|====
| Inputs <% 
if (inputs) { %>
| <% inputs.each {
      out.println "<<typesystem-reference.adoc#type-${it},${it.tokenize('.')[-1]}>>"
    }
  %>
<% } else { // inputs %>
| __none specified__
<% } // inputs %>

| Outputs <% 
if (outputs) { %>
| <% outputs.each {
      out.println "<<typesystem-reference.adoc#type-${it},${it.tokenize('.')[-1]}>>"
    }
  %>
<% } else { // outputs %>
| __none specified__
<% } // outputs %>
|====
<% } // inputs/outputs %>

<% } // component %>
<% } // component group%>
