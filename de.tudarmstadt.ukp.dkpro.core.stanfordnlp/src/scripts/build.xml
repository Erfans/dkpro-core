<project basedir="../.." default="separate-jars">
	<import>
		<url url="http://dkpro-core-asl.googlecode.com/svn/built-ant-macros/tags/0.1.0/ant-macros.xml"/>
	</import>
	
	<target name="local-maven">
		<property name="install-artifact-enable" value="true"/>
		<antcall target="separate-jars"/>
	</target>
	
	<target name="separate-jars" depends="separate-jars-parser, separate-jars-postagger, separate-jars-ner"/>
		
	<target name="separate-jars-postagger">
		<property name="outputDir" value="target/model-staging/de/tudarmstadt/ukp/dkpro/core/stanfordnlp"/>
		<antcall target="download-postagger"/>
		
    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/postagger/arabic-accurate.tagger" md5="730f09c873334d7ea1dc319aeac8b827"
    		tool="postagger" language="ar" variant="accurate" extension="tagger" version="3.0.3"/>		
    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/postagger/arabic-fast.tagger" md5="cc88707a0f57a2a303b40428d96a5853"
    		tool="postagger" language="ar" variant="fast" extension="tagger" version="3.0.3"/>		
		
    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/postagger/chinese.tagger" md5="77b63c53d00e92ac669d8daf5418e652"
    		tool="postagger" language="zh" variant="default" extension="tagger" version="3.0.3"/>	
		
    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/postagger/german-accurate.tagger" md5="e82ac97aed58af9d2fe54e428433145a"
    		tool="postagger" language="de" variant="accurate" extension="tagger" version="3.0.3"/>		
    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp" 
    		file="target/download/postagger/german-fast.tagger" md5="8494b5e56c1545cca77bf7faf7b9967c"
    		tool="postagger" language="de" variant="fast" extension="tagger" version="3.0.3"/>		

    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/postagger/bidirectional-distsim-wsj-0-18.tagger" md5="e230dffde190709c5c1bc0ed9a12ac3b"
    		tool="postagger" language="en" variant="bidirectional-distsim-wsj-0-18" extension="tagger" version="3.0.3"/>		
    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/postagger/left3words-distsim-wsj-0-18.tagger" md5="2d8ae6a806a1a880ce49ec07d60740e9"
    		tool="postagger" language="en" variant="left3words-distsim-wsj-0-18" extension="tagger" version="3.0.3"/>		
    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/postagger/left3words-wsj-0-18.tagger" md5="5d9319fd95b18dacb2551529878313eb"
    		tool="postagger" language="en" variant="left3words-wsj-0-18" extension="tagger" version="3.0.3"/>		

		<!--
		<antcall target="download-core"/>
    	<install-model-file file="target/download/core/bidirectional-distsim-wsj-0-18.tagger" md5="e230dffde190709c5c1bc0ed9a12ac3b"
    		tool="postagger" language="en" variant="bidirectional-distsim-wsj-0-18" extension="tagger" version="1.1.0"/>		
    	<install-model-file file="target/download/core/left3words-distsim-wsj-0-18.tagger" md5="2d8ae6a806a1a880ce49ec07d60740e9"
    		tool="postagger" language="en" variant="left3words-distsim-wsj-0-18.tagger" extension="tagger" version="1.1.0"/>		
    	-->
		
		<!-- antcall target="jar-notice"/ -->
	</target>

	<target name="separate-jars-ner">
		<property name="outputDir" value="target/model-staging/de/tudarmstadt/ukp/dkpro/core/stanfordnlp"/>
		<antcall target="download-core"/>
		<antcall target="download-german-ner"/>

    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/core/muc.distsim.crf.ser.gz" md5="947710871ee62cbe94e8b21f2c934581"
    		tool="ner" language="en" variant="muc.distsim.crf" extension="ser.gz" version="1.1.0"/>		

    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/core/conll.distsim.crf.ser.gz" md5="bac8f4552bb6875f53a28d2803034fc5"
    		tool="ner" language="en" variant="conll.distsim.crf" extension="ser.gz" version="1.1.0"/>		

		<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
			file="target/download/core/all.3class.distsim.crf.ser.gz" md5="163502a20d89b686767281dc001cc55f"
    		tool="ner" language="en" variant="all.3class.distsim.crf" extension="ser.gz" version="1.1.0"/>	

		<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp" 
			file="target/download/german-ner/hgc_175m_600.crf.ser.gz" md5="39861454dc9e3b2eb391dd5b7139bc1b"
    		tool="ner" language="de" variant="hgc_175m_600.crf" extension="ser.gz" version="20110920"/>		
		
		<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp" 
			file="target/download/german-ner/dewac_175m_600.crf.ser.gz" md5="4722078875ddd5658f37e496f4b54b1d"
    		tool="ner" language="de" variant="dewac_175m_600.crf" extension="ser.gz" version="20110920"/>	
		<!-- antcall target="jar-notice"/ -->
	</target>
			
	<target name="separate-jars-parser">
		<property name="outputDir" value="target/model-staging/de/tudarmstadt/ukp/dkpro/core/stanfordnlp"/>
		<antcall target="download-parser"/>
		
    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/parser/englishPCFG.ser.gz" md5="e38a2ba7132885ce7831d7b041dfe53b"
    		tool="lexparser" language="en" variant="pcfg" extension="ser.gz" version="1.6.8"/>		

    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/parser/englishFactored.ser.gz" md5="caeb3dde2182aca910371a1b20001996"
    		tool="lexparser" language="en" variant="factored" extension="ser.gz" version="1.6.8"/>		
		
    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/parser/germanPCFG.ser.gz" md5="297fc99f598d540a458a28a34b609dfa"
    		tool="lexparser" language="de" variant="pcfg" extension="ser.gz" version="1.6.8"/>		

    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/parser/germanFactored.ser.gz" md5="20a892c9dca77384ff94de30da7f17ec"
    		tool="lexparser" language="de" variant="factored" extension="ser.gz" version="1.6.8"/>		

    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/parser/chinesePCFG.ser.gz" md5="2708afbe2a747b3960b06e725446dab4"
    		tool="lexparser" language="zh" variant="pcfg" extension="ser.gz" version="1.6.8"/>		

    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/parser/chineseFactored.ser.gz" md5="ade577a42684c3c1f2a8de3b52bfd392"
    		tool="lexparser" language="zh" variant="factored" extension="ser.gz" version="1.6.8"/>		

    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/parser/arabicFactored.ser.gz" md5="3c50969716fe411c4109e7c5999d7be7"
    		tool="lexparser" language="ar" variant="factored" extension="ser.gz" version="1.6.8"/>		
		
    	<install-model-file groupId="de.tudarmstadt.ukp.dkpro.core" artifactIdBase="de.tudarmstadt.ukp.dkpro.core.stanfordnlp"
    		file="target/download/parser/frenchFactored.ser.gz" md5="1de6d989344f5abe076956473832dbdf"
    		tool="lexparser" language="fr" variant="factored" extension="ser.gz" version="1.6.8"/>		

		<!-- This should be the same as the model file rolled out with the parser package
		<antcall target="download-core"/>
    	<install-model-file file="target/download/core/englishPCFG.ser.gz" md5="cb662b2f737846558c3e2bc9d54b0641"
    		tool="lexparser" language="en" variant="pcfg" extension="ser.gz" version="1.1.0"/>		
    	-->
		<!-- antcall target="jar-notice"/ -->
	</target>

	<target name="download-german-ner">
		<mkdir dir="target/download/german-ner"/>
		<get src="http://nlp.stanford.edu/software/ner.german.tgz" dest="target/download/german-ner/ner.german.tar.gz" skipexisting="true"/>
    	<gunzip src="target/download/german-ner/ner.german.tar.gz"/>
    	<untar src="target/download/german-ner/ner.german.tar" dest="target/download/german-ner">
    		<chainedmapper>
	    		<mapper type="flatten"/>
    		</chainedmapper>
    	</untar>
    	<delete file="target/download/german-ner/ner.german.tar"/>
	</target>
	
	<target name="download-core">
		<mkdir dir="target/download/core"/>
    	<get src="http://nlp.stanford.edu/software/stanford-corenlp-v1.1.0.tgz" dest="target/download/core/core-nlp.tar.gz" skipexisting="true"/>
    	<gunzip src="target/download/core/core-nlp.tar.gz"/>
    	<untar src="target/download/core/core-nlp.tar" dest="target/download/core">
    		<patternset>
    			<include name="**/stanford-corenlp-models*"/>		
			</patternset>
    		<chainedmapper>
	    		<mapper type="flatten"/>
	    		<firstmatchmapper>
					<globmapper from="*" to="stanford-corenlp-models.jar"/>
				</firstmatchmapper>
    		</chainedmapper>
    	</untar>
		<unzip src="target/download/core/stanford-corenlp-models.jar" dest="target/download/core">
    		<patternset>
    			<include name="**/*.ser.gz"/>		
    			<include name="**/*.tagger*"/>		
			</patternset>
    		<chainedmapper>
	    		<mapper type="flatten"/>
    		</chainedmapper>
		</unzip>
    	<delete file="target/download/core/stanford-corenlp-models.jar"/>
    	<!--delete file="target/download/core/core-nlp.tar.gz"/-->
    	<delete file="target/download/core/core-nlp.tar"/>
	</target>

	<target name="download-parser">
		<mkdir dir="target/download/parser"/>
    	<get src="http://nlp.stanford.edu/software/stanford-parser-2011-06-27.tgz" dest="target/download/parser/parser.tar.gz" skipexisting="true"/>
    	<gunzip src="target/download/parser/parser.tar.gz"/>
    	<untar src="target/download/parser/parser.tar" dest="target/download/parser">
    		<patternset>
    			<include name="**/grammar/**/*.ser.gz"/>		
			</patternset>
    		<chainedmapper>
	    		<mapper type="flatten"/>
    		</chainedmapper>
    	</untar>
    	<!--delete file="target/download/parser/parser.tar.gz"/-->
    	<delete file="target/download/parser/parser.tar"/>
	</target>

	<target name="download-postagger">
		<mkdir dir="target/download/postagger"/>
    	<get src="http://nlp.stanford.edu/software/stanford-postagger-full-2011-06-19.tgz" dest="target/download/postagger/postagger.tar.gz" skipexisting="true"/>
	   	<gunzip src="target/download/postagger/postagger.tar.gz"/>
    	<untar src="target/download/postagger/postagger.tar" dest="target/download/postagger">
    		<patternset>
    			<include name="**/models//*.tagger*"/>		
			</patternset>
    		<chainedmapper>
	    		<mapper type="flatten"/>
    		</chainedmapper>
    	</untar>
    	<!--delete file="target/download/parser/postagger.tar.gz"/-->
    	<delete file="target/download/parser/postagger.tar"/>
	</target>

	<target name="jar-notice">
		<echo>================================</echo>
		<echo>== IMPORTANT LICENSE REMINDER ==</echo>
		<echo>================================</echo>
		<echo> </echo>
		<echo>YOU MAY NOT REDISTRIBUTE THESE JARS WITHOUT THE EXPLICIT PERMISSION</echo>
		<echo> </echo>
		<echo>from their respective original creators.</echo>
		<echo> </echo>
		<echo>For Maven users:</echo>
		<echo> </echo>
		<echo>If you choose to upload these JARs to a PRIVATE repository or install them in</echo>
		<echo>your local repository, use the following groupId and artifactId scheme:</echo>
		<echo> </echo>
		<echo>    groupId: de.tudarmstadt.ukp.dkpro.core</echo>
		<echo> artifactId: de.tudarmstadt.ukp.dkpro.core.stanfordnlp-model-&lt;tool&gt;-&lt;lang&gt;-&lt;variant&gt;</echo>
		<echo>    version: &lt;use the timestamp encoded in the JAR file name&gt;</echo>
		<echo> </echo>
		<echo> Example:</echo>
		<echo> </echo>
		<echo>    groupId: de.tudarmstadt.ukp.dkpro.core</echo>
		<echo> artifactId: de.tudarmstadt.ukp.dkpro.core.stanfordnlp-model-lexparser-en-pcfg</echo>
		<echo>    version: 1.0.2</echo>
		<echo> </echo>
		<echo>If you have done that, you may enable the Maven profile "use-proprietary-resources"</echo>
		<echo>to enable additional test cases when building the DKPro Stanford NLP Integration.</echo>
		<echo> </echo>
		<echo>AGAIN REMEMBER THAT YOU MAY NOT REDISTRIBUTE THESE JARS - Thanks.</echo>
	</target>
	
	<macrodef name="install-model-file">
		<attribute name="file"/>
		<attribute name="groupId"/>
		<attribute name="artifactIdBase"/>
		<attribute name="extension"/>
		<attribute name="variant"/>
		<attribute name="tool"/>
		<attribute name="language"/>
		<attribute name="version"/>
		<attribute name="md5"/>
		<attribute name="prop.verify.md5" default="verify.md5.@{tool}.@{language}.@{variant}"/>
		<attribute name="prop.verify.md5.actual" default="verify.md5.actual.@{tool}.@{language}.@{variant}"/>
		<sequential>
			<fail unless="outputDir">No output directory set.</fail>
	    	<mkdir dir="${outputDir}/lib"/>
			<copy file="@{file}" tofile="${outputDir}/lib/@{tool}-@{language}-@{variant}.@{extension}"/>
			<copy file="@{file}.props" tofile="${outputDir}/lib/@{tool}-@{language}-@{variant}.@{extension}.props" failonerror="false"/>
			
			<generate-model-properties tool="@{tool}" language="@{language}" variant="@{variant}"
				extension="@{extension}"/>
			<clean-pom/>
			<generate-pom version="@{version}" groupId="@{groupId}" 
				artifactId="@{artifactIdBase}-model-@{tool}-@{language}-@{variant}"/>
			
			<checksum file="${outputDir}/lib/@{tool}-@{language}-@{variant}.@{extension}" property="@{md5}" verifyproperty="@{prop.verify.md5}"/>
			<checksum file="${outputDir}/lib/@{tool}-@{language}-@{variant}.@{extension}" property="@{prop.verify.md5.actual}"/>
			<condition property="checksum.mismatch">
				<equals arg1="false" arg2="${@{prop.verify.md5}}"/>
			</condition>
			<fail if="checksum.mismatch">
MD5 checksum mismatch for @{tool}-@{language}-@{variant}.@{extension}.
Please verify the checksum and if necessary update this script.
Expected: @{md5}
Actual  : ${@{prop.verify.md5.actual}}
			</fail>

			<jar destfile="target/@{artifactIdBase}-model-@{tool}-@{language}-@{variant}-@{version}.jar" compress="true">
				<fileset dir="target/model-staging">
					<include name="META-INF/**/*"/>
					<include name="**/lib/@{tool}-@{language}-@{variant}*"/>
				</fileset>
			</jar>
			
			<install-artifact file="target/@{artifactIdBase}-model-@{tool}-@{language}-@{variant}-@{version}.jar"
				groupId="@{groupId}" artifactId="@{artifactIdBase}-model-@{tool}-@{language}-@{variant}" version="@{version}"/>
			
			<clean-pom/>
		</sequential>
	</macrodef>

	<macrodef name="generate-model-properties">
		<attribute name="tool"/>
		<attribute name="language"/>
		<attribute name="extension"/>
		<attribute name="variant"/>
		<attribute name="prop.checksum.md5" default="checksum.md5.@{tool}-@{language}-@{variant}"/>
		<attribute name="prop.checksum.sha1" default="checksum.sha1.@{tool}-@{language}-@{variant}"/>
		<sequential>
			<checksum file="${outputDir}/lib/@{tool}-@{language}-@{variant}.@{extension}" property="@{prop.checksum.md5}"
				algorithm="MD5"/>
			<checksum file="${outputDir}/lib/@{tool}-@{language}-@{variant}.@{extension}" property="@{prop.checksum.sha1}"
				algorithm="SHA"/>
			<propertyfile file="${outputDir}/lib/@{tool}-@{language}-@{variant}.properties"
				comment="Stanford NLP tools model description">
				<entry  key="downloaded" type="date" value="now"/>
				<entry  key="tool" value="@{tool}"/>
				<entry  key="language" value="@{language}"/>
				<entry  key="variant" value="@{variant}"/>
				<entry  key="md5" value="${@{prop.checksum.md5}}"/>
				<entry  key="sha1" value="${@{prop.checksum.sha1}}"/>
			</propertyfile>
			<echo>Installed @{tool} model file for @{language} in variant @{variant}</echo>
		</sequential>
	</macrodef>
</project>